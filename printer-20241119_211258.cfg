[include mainsail.cfg]
[include dragonburner_leds.cfg]
[include macros.cfg]
#[include purge_bucket_scrubber.cfg]

[mcu]
canbus_uuid: dc57f6294346

[mcu can0]
canbus_uuid=4d980282845f

[exclude_object]

[skew_correction]

[idle_timeout]
timeout: 36000

[printer]
kinematics: corexy
max_velocity: 3000  
max_accel: 7900    			#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 4.0

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor SoC]
sensor_type: temperature_host

[temperature_sensor CANBOARD]
sensor_type: temperature_mcu
sensor_mcu: can0

[temperature_sensor chamber]
sensor_type: Generic 3950
Sensor_pin: PA4

########################
# X/Y Stepper Settings #
########################

[stepper_x]
step_pin: PE2
dir_pin: PB4
enable_pin: !PC11
microsteps: 32
rotation_distance: 40
endstop_pin: ^can0:PB8
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC10
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_y]
step_pin: PF12
dir_pin: PF11
enable_pin: !PB3
microsteps: 32
rotation_distance: 40
endstop_pin: ^PF3
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PF13
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0

######################
# Z Stepper Settings #
######################

[stepper_z]
step_pin: PD8
dir_pin: !PC6
enable_pin: !PC7
rotation_distance: 4
microsteps: 32
#endstop_pin: ^PF5
#position_endstop: -0.5
endstop_pin: probe:z_virtual_endstop
position_max: 340
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PD10
interpolate: true
run_current: 0.8
#hold_current: 0.8
sense_resistor: 0.110
#stealthchop_threshold: 0

[stepper_z1]
step_pin: PD3
dir_pin: !PD2
enable_pin: !PD5
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PD4
interpolate: true
run_current: 0.8
#hold_current: 0.8
sense_resistor: 0.110
#stealthchop_threshold: 0

[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PD1
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PD0
interpolate: true
run_current: 0.8
#hold_current: 0.80
sense_resistor: 0.110
#stealthchop_threshold: 0


############
# Extruder #
############

[extruder]
step_pin: can0:PD0
dir_pin: can0:PD1
enable_pin: !can0:PD2
rotation_distance: 4.6824
#gear_ratio: 50:10 
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 100.00
max_extrude_only_velocity: 75.0
max_extrude_only_accel: 1500
max_extrude_cross_section: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:PB13
sensor_pin: can0:PA3
sensor_type: ATC Semitec 104NT-4-R025H42G
control: pid
pid_Kp: 21.507
pid_Ki: 1.887
pid_Kd: 61.296
min_temp: 10
max_temp: 290
min_extrude_temp: 180
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: can0:PA15
stealthchop_threshold: 0
run_current: 0.85

[gcode_arcs]
resolution: 0.1

##############
# Bed Heater #
##############

[heater_bed]
heater_pin: PE3
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA0
max_power: 1.0
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.0166
control: pid
pid_kp: 58.437
pid_ki: 2.347
pid_kd: 363.769

[verify_heater heater_bed]
max_error: 50
check_gain_time: 99999
hysteresis: 5
heating_gain: 2

###############
# Fan Control #
###############

[heater_fan hotend_fan]
pin: can0:PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

## PART COOLING
[fan]
pin: can0:PA1
kick_start_time: 0.5
#cycle_time: 0.15
off_below: 0.10

[heater_fan controller_fan_1]
pin: PE6
kick_start_time: 0.5
heater: heater_bed
heater_temp: 20.0

[heater_fan controller_fan_2]
pin: PE0
kick_start_time: 0.5
heater: heater_bed
heater_temp: 20.0

[heater_fan nevermore_fan]
pin: PE4 
kick_start_time: 0.5
heater: heater_bed
heater_temp: 50
fan_speed: 1.0

#################
#  LED Control  #
#################

[output_pin Under Caselight]
pin: PC12
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

[output_pin Above Caselight]
pin: PE5
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

#####################################################
#  Homing, Gantry and Bed Mesh Adjustment Routines  #
#####################################################

[safe_z_home]
home_xy_position:175,175
speed:350
z_hop:20


[z_tilt]
z_positions:
   -50, 18
   175, 398
   400, 18
points:
   50, 5
   175, 300
   300, 5

speed: 400
horizontal_move_z: 10
retries: 20
retry_tolerance: 0.0050

[bed_mesh]
speed: 500
horizontal_move_z: 10
mesh_min: 30,30
mesh_max: 310,310
fade_start: 0.6
fade_end: 10.0
probe_count: 20,20
mesh_pps:2,2
algorithm: bicubic
zero_reference_position: 175, 175

[scanner]
canbus_uuid: f1c7a35486a3            
x_offset: 0                          #    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 27.0                       #    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.00308               #   Backlash compensation distance for removing Z backlash before measuring the sensor response. 
calibration_method: touch            #    leave this as touch unless you want to use scan only for everything. 
sensor: cartographer                 #    this must be set as cartographer unless using IDM etc.
sensor_alt: carto                    #    alternate name to call commands. CARTO_TOUCH etc
#scanner_touch_z_offset: 0.05        #    This is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset
mesh_runs: 2                         #    Number of passes to make during mesh scan.

###################
#  Input Shaping  #
###################

##EBB36
[adxl345]
cs_pin: can0:PB12
spi_software_sclk_pin: can0:PB10
spi_software_mosi_pin: can0:PB11
spi_software_miso_pin: can0:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
    175,175,20  # an example for a 350mm printer
    
[input_shaper]
shaper_freq_x: 79.4 # center frequency for the X axis filter
shaper_type_x: ei # filter type for the X axis
damping_ratio_x: 0.053 # damping ratio for the X axis
shaper_freq_y: 69.6 # center frequency for the Y axis filter
shaper_type_y: 2hump_ei # filter type for the Y axis
damping_ratio_y: 0.053 # damping ratio for the Y axis

[autotune_tmc stepper_x]
motor: moons-ms17hd6p420I-05
tuning_goal: auto
pwm_freq_target: 22e3

[autotune_tmc stepper_y]
motor: moons-ms17hd6p420I-05
tuning_goal: auto
pwm_freq_target: 22e3

[autotune_tmc extruder]
motor: ldo-36sth20-1004ahg
tuning_goal: auto

[autotune_tmc stepper_z]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

[autotune_tmc stepper_z1]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

[autotune_tmc stepper_z2]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

##Cartographer
#[lis2dw]
#cs_pin: cartographer:PA3
#spi_bus: spi1
#
#[resonance_tester]
#accel_chip: lis2dw
#probe_points:
#    175, 175, 20

[gcode_arcs]
resolution: 0.3

    
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.114513, 0.107610, 0.091947, 0.079474, 0.088513, 0.076825, 0.066884, 0.079885, 0.061348, 0.077436, 0.067893, 0.065287, 0.096207, 0.088258, 0.088620, 0.090301, 0.082681, 0.101711, 0.105563, 0.121897
#*# 	  0.093372, 0.085908, 0.069083, 0.067806, 0.069605, 0.050039, 0.052706, 0.060548, 0.056910, 0.064504, 0.050525, 0.061214, 0.086490, 0.078718, 0.090061, 0.074294, 0.084059, 0.097307, 0.087682, 0.116444
#*# 	  0.066667, 0.057926, 0.039937, 0.050801, 0.046607, 0.052606, 0.038287, 0.036236, 0.055127, 0.043867, 0.048836, 0.053831, 0.054369, 0.071986, 0.074938, 0.073240, 0.075834, 0.070644, 0.093899, 0.090502
#*# 	  0.044341, 0.039989, 0.030978, 0.040412, 0.021937, 0.026795, 0.028603, 0.037783, 0.044591, 0.031027, 0.043410, 0.045854, 0.058919, 0.066179, 0.058659, 0.070018, 0.079468, 0.078335, 0.093660, 0.084624
#*# 	  0.019867, 0.022632, 0.009546, -0.000482, 0.016484, 0.005140, 0.012875, 0.021690, 0.016552, 0.038076, 0.029587, 0.029425, 0.054930, 0.041958, 0.060863, 0.063492, 0.060496, 0.074975, 0.066061, 0.088418
#*# 	  0.001836, 0.001691, -0.016658, -0.014162, -0.002976, -0.015368, 0.001150, 0.018738, 0.012788, 0.023753, 0.005527, 0.022735, 0.038964, 0.035408, 0.050965, 0.058817, 0.058378, 0.071992, 0.055496, 0.087614
#*# 	  0.005619, -0.005483, -0.015300, -0.021372, -0.017577, -0.010743, -0.007868, 0.006808, 0.015474, 0.014374, 0.014689, 0.009287, 0.037597, 0.047613, 0.039257, 0.056478, 0.063310, 0.061358, 0.072081, 0.077605
#*# 	  -0.018547, -0.025643, -0.035120, -0.044429, -0.030860, -0.023027, -0.017204, -0.006525, 0.005152, 0.007388, 0.009895, 0.005795, 0.028975, 0.037345, 0.036924, 0.048565, 0.043141, 0.054192, 0.073665, 0.080761
#*# 	  -0.036643, -0.042440, -0.034242, -0.039772, -0.034864, -0.029986, -0.021984, -0.004452, -0.000494, 0.017036, 0.006419, 0.001482, 0.030267, 0.034818, 0.040108, 0.047412, 0.039029, 0.058079, 0.063530, 0.077719
#*# 	  -0.037524, -0.045888, -0.049141, -0.049013, -0.033105, -0.027553, -0.016018, -0.007414, -0.004056, 0.005776, 0.011243, 0.016076, 0.021532, 0.029791, 0.039500, 0.047115, 0.053379, 0.060276, 0.076143, 0.082501
#*# 	  -0.051781, -0.045119, -0.053788, -0.051795, -0.048926, -0.038133, -0.020227, -0.014684, -0.006294, 0.004382, 0.005819, 0.015509, 0.019167, 0.030055, 0.046029, 0.046226, 0.058868, 0.064881, 0.071746, 0.088189
#*# 	  -0.054587, -0.061863, -0.056739, -0.063918, -0.051580, -0.041287, -0.030016, -0.017289, -0.014973, 0.001336, 0.010698, 0.010577, 0.020841, 0.025538, 0.041905, 0.055027, 0.053341, 0.066711, 0.067154, 0.087293
#*# 	  -0.061407, -0.061774, -0.078057, -0.066932, -0.062049, -0.044888, -0.033624, -0.029491, -0.018753, -0.003174, 0.007679, 0.010623, 0.025514, 0.031868, 0.046116, 0.054483, 0.060110, 0.062485, 0.082668, 0.090909
#*# 	  -0.053465, -0.068708, -0.067087, -0.059582, -0.056255, -0.047345, -0.025651, -0.016714, -0.012651, -0.001489, 0.006719, 0.026049, 0.037810, 0.045433, 0.050432, 0.066272, 0.068766, 0.070059, 0.089976, 0.104060
#*# 	  -0.059060, -0.058950, -0.059210, -0.057865, -0.044967, -0.036253, -0.030000, -0.022921, -0.011307, 0.003186, 0.009806, 0.028763, 0.046937, 0.047268, 0.058007, 0.073358, 0.071705, 0.078242, 0.097128, 0.114947
#*# 	  -0.060470, -0.057070, -0.056230, -0.053718, -0.046454, -0.038852, -0.025390, -0.010821, -0.010285, 0.003320, 0.014180, 0.033280, 0.048070, 0.052906, 0.069944, 0.076373, 0.072934, 0.090140, 0.110909, 0.139332
#*# 	  -0.068343, -0.068050, -0.068556, -0.054833, -0.043822, -0.037114, -0.025002, -0.011561, -0.006896, 0.007433, 0.022483, 0.037042, 0.058031, 0.068691, 0.074569, 0.081499, 0.082596, 0.095242, 0.112058, 0.133159
#*# 	  -0.059037, -0.059461, -0.053561, -0.051461, -0.039003, -0.030362, -0.024840, -0.003845, 0.003031, 0.014560, 0.027788, 0.047164, 0.066554, 0.078064, 0.086167, 0.093727, 0.098463, 0.109833, 0.130237, 0.146842
#*# 	  -0.050106, -0.044878, -0.042152, -0.035284, -0.021424, -0.016651, 0.000124, 0.015151, 0.024661, 0.035023, 0.045386, 0.063007, 0.082995, 0.099368, 0.114586, 0.122275, 0.122069, 0.130451, 0.150303, 0.168359
#*# 	  -0.043456, -0.031246, -0.026291, -0.019473, -0.002072, 0.002390, 0.013550, 0.027741, 0.047095, 0.058410, 0.065455, 0.079794, 0.097740, 0.108479, 0.130499, 0.145902, 0.147492, 0.154707, 0.166870, 0.187723
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 310.0
#*# min_y = 30.0
#*# max_y = 310.0
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = -0.0006646821849444252
#*# xz_skew = -9.899520833820424e-05
#*# yz_skew = -0.003408273324093036
#*#
#*# [scanner model default]
#*# model_coef = 1.4881108502639888,
#*# 	1.9216407342142658,
#*# 	0.7543676103919833,
#*# 	0.3483028551061505,
#*# 	0.2937311797389149,
#*# 	0.22668854586576817,
#*# 	-0.1322971558424774,
#*# 	-0.15464610683832222,
#*# 	0.14627451119428886,
#*# 	0.1131600342243656
#*# model_domain = 3.3116862529045835e-07,3.374143229040644e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 61.653238
#*# model_offset = 0.00000
#*#
#*# [scanner]
#*# scanner_touch_threshold = 1750
#*# scanner_touch_z_offset = 0.075
