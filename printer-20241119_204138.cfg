[include mainsail.cfg]
[include dragonburner_leds.cfg]
[include macros.cfg]
#[include purge_bucket_scrubber.cfg]

[mcu]
canbus_uuid: dc57f6294346

[mcu can0]
canbus_uuid=4d980282845f

[exclude_object]

[skew_correction]

[idle_timeout]
timeout: 36000

[printer]
kinematics: corexy
max_velocity: 3000  
max_accel: 7900    			#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 4.0

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor SoC]
sensor_type: temperature_host

[temperature_sensor CANBOARD]
sensor_type: temperature_mcu
sensor_mcu: can0

[temperature_sensor chamber]
sensor_type: Generic 3950
Sensor_pin: PA4

########################
# X/Y Stepper Settings #
########################

[stepper_x]
step_pin: PE2
dir_pin: PB4
enable_pin: !PC11
microsteps: 32
rotation_distance: 40
endstop_pin: ^can0:PB8
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC10
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_y]
step_pin: PF12
dir_pin: PF11
enable_pin: !PB3
microsteps: 32
rotation_distance: 40
endstop_pin: ^PF3
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PF13
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0

######################
# Z Stepper Settings #
######################

[stepper_z]
step_pin: PD8
dir_pin: !PC6
enable_pin: !PC7
rotation_distance: 4
microsteps: 32
#endstop_pin: ^PF5
#position_endstop: -0.5
endstop_pin: probe:z_virtual_endstop
position_max: 340
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PD10
interpolate: true
run_current: 0.8
#hold_current: 0.8
sense_resistor: 0.110
#stealthchop_threshold: 0

[stepper_z1]
step_pin: PD3
dir_pin: !PD2
enable_pin: !PD5
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PD4
interpolate: true
run_current: 0.8
#hold_current: 0.8
sense_resistor: 0.110
#stealthchop_threshold: 0

[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PD1
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PD0
interpolate: true
run_current: 0.8
#hold_current: 0.80
sense_resistor: 0.110
#stealthchop_threshold: 0


############
# Extruder #
############

[extruder]
step_pin: can0:PD0
dir_pin: can0:PD1
enable_pin: !can0:PD2
rotation_distance: 4.6824
#gear_ratio: 50:10 
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 100.00
max_extrude_only_velocity: 75.0
max_extrude_only_accel: 1500
max_extrude_cross_section: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:PB13
sensor_pin: can0:PA3
sensor_type: ATC Semitec 104NT-4-R025H42G
control: pid
pid_Kp: 21.507
pid_Ki: 1.887
pid_Kd: 61.296
min_temp: 10
max_temp: 290
min_extrude_temp: 180
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: can0:PA15
stealthchop_threshold: 0
run_current: 0.85

[gcode_arcs]
resolution: 0.1

##############
# Bed Heater #
##############

[heater_bed]
heater_pin: PE3
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA0
max_power: 1.0
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.0166
control: pid
pid_kp: 58.437
pid_ki: 2.347
pid_kd: 363.769

[verify_heater heater_bed]
max_error: 50
check_gain_time: 99999
hysteresis: 5
heating_gain: 2

###############
# Fan Control #
###############

[heater_fan hotend_fan]
pin: can0:PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

## PART COOLING
[fan]
pin: can0:PA1
kick_start_time: 0.5
#cycle_time: 0.15
off_below: 0.10

[heater_fan controller_fan_1]
pin: PE6
kick_start_time: 0.5
heater: heater_bed
heater_temp: 20.0

[heater_fan controller_fan_2]
pin: PE0
kick_start_time: 0.5
heater: heater_bed
heater_temp: 20.0

[heater_fan nevermore_fan]
pin: PE4 
kick_start_time: 0.5
heater: heater_bed
heater_temp: 50
fan_speed: 1.0

#################
#  LED Control  #
#################

[output_pin Under Caselight]
pin: PC12
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

[output_pin Above Caselight]
pin: PE5
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

#####################################################
#  Homing, Gantry and Bed Mesh Adjustment Routines  #
#####################################################

[safe_z_home]
home_xy_position:175,175
speed:350
z_hop:20


[z_tilt]
z_positions:
   -50, 18
   175, 398
   400, 18
points:
   50, 5
   175, 300
   300, 5

speed: 400
horizontal_move_z: 10
retries: 20
retry_tolerance: 0.0050

[bed_mesh]
speed: 500
horizontal_move_z: 10
mesh_min: 30,30
mesh_max: 310,310
fade_start: 0.6
fade_end: 10.0
probe_count: 20,20
mesh_pps:2,2
algorithm: bicubic
zero_reference_position: 175, 175

[scanner]
canbus_uuid: f1c7a35486a3            
x_offset: 0                          #    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 27.0                       #    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.00308               #   Backlash compensation distance for removing Z backlash before measuring the sensor response. 
calibration_method: touch            #    leave this as touch unless you want to use scan only for everything. 
sensor: cartographer                 #    this must be set as cartographer unless using IDM etc.
sensor_alt: carto                    #    alternate name to call commands. CARTO_TOUCH etc
#scanner_touch_z_offset: 0.05        #    This is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset
mesh_runs: 2                         #    Number of passes to make during mesh scan.

###################
#  Input Shaping  #
###################

##EBB36
[adxl345]
cs_pin: can0:PB12
spi_software_sclk_pin: can0:PB10
spi_software_mosi_pin: can0:PB11
spi_software_miso_pin: can0:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
    175,175,20  # an example for a 350mm printer
    
[input_shaper]
shaper_freq_x: 79.4 # center frequency for the X axis filter
shaper_type_x: ei # filter type for the X axis
damping_ratio_x: 0.053 # damping ratio for the X axis
shaper_freq_y: 69.6 # center frequency for the Y axis filter
shaper_type_y: 2hump_ei # filter type for the Y axis
damping_ratio_y: 0.053 # damping ratio for the Y axis

[autotune_tmc stepper_x]
motor: moons-ms17hd6p420I-05
tuning_goal: auto
pwm_freq_target: 22e3

[autotune_tmc stepper_y]
motor: moons-ms17hd6p420I-05
tuning_goal: auto
pwm_freq_target: 22e3

[autotune_tmc extruder]
motor: ldo-36sth20-1004ahg
tuning_goal: auto

[autotune_tmc stepper_z]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

[autotune_tmc stepper_z1]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

[autotune_tmc stepper_z2]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

##Cartographer
#[lis2dw]
#cs_pin: cartographer:PA3
#spi_bus: spi1
#
#[resonance_tester]
#accel_chip: lis2dw
#probe_points:
#    175, 175, 20

[gcode_arcs]
resolution: 0.3

    
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.116304, 0.103212, 0.088838, 0.088123, 0.074443, 0.073581, 0.069345, 0.068086, 0.069325, 0.059836, 0.061328, 0.065955, 0.080507, 0.081931, 0.078552, 0.080403, 0.081629, 0.086384, 0.091700, 0.100985
#*# 	  0.096611, 0.082673, 0.065255, 0.064971, 0.061025, 0.058742, 0.050177, 0.054898, 0.053954, 0.050433, 0.052831, 0.054401, 0.065953, 0.072088, 0.074235, 0.071632, 0.072295, 0.072492, 0.085641, 0.093111
#*# 	  0.059935, 0.056627, 0.043255, 0.043531, 0.049261, 0.038833, 0.036888, 0.043436, 0.041357, 0.044859, 0.043569, 0.047903, 0.061006, 0.060394, 0.070041, 0.062620, 0.066048, 0.072107, 0.075510, 0.087374
#*# 	  0.045261, 0.039391, 0.029947, 0.027036, 0.030766, 0.028363, 0.025740, 0.033353, 0.034519, 0.042336, 0.038572, 0.039499, 0.057843, 0.052762, 0.066078, 0.062496, 0.057713, 0.070964, 0.071548, 0.083466
#*# 	  0.021201, 0.020201, 0.007203, 0.005459, 0.010025, 0.006423, 0.010463, 0.019614, 0.029342, 0.026241, 0.024346, 0.025028, 0.041197, 0.042243, 0.052034, 0.054327, 0.052769, 0.057363, 0.064761, 0.071703
#*# 	  0.009284, -0.000096, -0.010470, -0.010008, -0.012508, -0.012991, 0.001908, 0.008639, 0.016596, 0.014089, 0.014525, 0.017444, 0.027855, 0.043718, 0.046153, 0.048055, 0.048988, 0.050179, 0.056770, 0.066555
#*# 	  0.006662, -0.003246, -0.016975, -0.020839, -0.018425, -0.011843, -0.001386, 0.008929, 0.006189, 0.012818, 0.008283, 0.015212, 0.029779, 0.036180, 0.040934, 0.044911, 0.047997, 0.051895, 0.062680, 0.073419
#*# 	  -0.016150, -0.020135, -0.033922, -0.035425, -0.030551, -0.021108, -0.016281, -0.004012, 0.005171, 0.007116, 0.002990, 0.007541, 0.025158, 0.022627, 0.031940, 0.041223, 0.033650, 0.044752, 0.054084, 0.071724
#*# 	  -0.036214, -0.039788, -0.037445, -0.037889, -0.032037, -0.026838, -0.019803, -0.010065, -0.002542, 0.018872, 0.004052, 0.004689, 0.021339, 0.026161, 0.035787, 0.039972, 0.033662, 0.042094, 0.051231, 0.064931
#*# 	  -0.033119, -0.042888, -0.048840, -0.048918, -0.037867, -0.029408, -0.019190, -0.007270, -0.003445, 0.002592, 0.008899, 0.006873, 0.023108, 0.025594, 0.031946, 0.042879, 0.043664, 0.059800, 0.062438, 0.074324
#*# 	  -0.050666, -0.050423, -0.053131, -0.055855, -0.043949, -0.037817, -0.023966, -0.009067, -0.006683, 0.002129, 0.006120, 0.009100, 0.014961, 0.023987, 0.043269, 0.043706, 0.042051, 0.052353, 0.060837, 0.074513
#*# 	  -0.057665, -0.061131, -0.066233, -0.064786, -0.047358, -0.041496, -0.032164, -0.025300, -0.013202, -0.002141, 0.002310, 0.009880, 0.015823, 0.023309, 0.037931, 0.045650, 0.041937, 0.056315, 0.061141, 0.073108
#*# 	  -0.063524, -0.057964, -0.072504, -0.067580, -0.058334, -0.048198, -0.035384, -0.025535, -0.017762, -0.008259, -0.002299, 0.007582, 0.022905, 0.026650, 0.041293, 0.044593, 0.048931, 0.057839, 0.066273, 0.077596
#*# 	  -0.054066, -0.064107, -0.067884, -0.064888, -0.054486, -0.047772, -0.029598, -0.017409, -0.013848, -0.004070, -0.000662, 0.014709, 0.034118, 0.041379, 0.050503, 0.054390, 0.050140, 0.057657, 0.074685, 0.092979
#*# 	  -0.060565, -0.060348, -0.060588, -0.059978, -0.047671, -0.039589, -0.032366, -0.024962, -0.015589, -0.002534, 0.004423, 0.024365, 0.045215, 0.036869, 0.050849, 0.059939, 0.057695, 0.065068, 0.084692, 0.099596
#*# 	  -0.060653, -0.057602, -0.059598, -0.057196, -0.048496, -0.040362, -0.026271, -0.017395, -0.012201, -0.000243, 0.011531, 0.026305, 0.041808, 0.043415, 0.058539, 0.064434, 0.061512, 0.072050, 0.095338, 0.121610
#*# 	  -0.067483, -0.071881, -0.062730, -0.056742, -0.047477, -0.038625, -0.031538, -0.015641, -0.011902, 0.004537, 0.015669, 0.031214, 0.047425, 0.059642, 0.064868, 0.070387, 0.068879, 0.075726, 0.099682, 0.110466
#*# 	  -0.064749, -0.062669, -0.059858, -0.053634, -0.042706, -0.035156, -0.025922, -0.013424, -0.003655, 0.008677, 0.018508, 0.037800, 0.058507, 0.065994, 0.074203, 0.082316, 0.083125, 0.093987, 0.109265, 0.126201
#*# 	  -0.048778, -0.046563, -0.047734, -0.045354, -0.025462, -0.021849, -0.005094, 0.009084, 0.017107, 0.023485, 0.036606, 0.056218, 0.070965, 0.085548, 0.098448, 0.099573, 0.104661, 0.111450, 0.129312, 0.148108
#*# 	  -0.049658, -0.036962, -0.031034, -0.027248, -0.010145, -0.006943, 0.009168, 0.019659, 0.037883, 0.049358, 0.056546, 0.067366, 0.085678, 0.094261, 0.112836, 0.127454, 0.127371, 0.134800, 0.144184, 0.162376
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 310.0
#*# min_y = 30.0
#*# max_y = 310.0
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = -0.0006646821849444252
#*# xz_skew = -9.899520833820424e-05
#*# yz_skew = -0.003408273324093036
#*#
#*# [scanner model default]
#*# model_coef = 1.3502720857341237,
#*# 	1.7744977526967847,
#*# 	0.7673434243370729,
#*# 	0.37229534700336436,
#*# 	0.35074991848714415,
#*# 	0.3430384820192276,
#*# 	-0.14611481361920253,
#*# 	-0.23952347113334832,
#*# 	0.227794178219985,
#*# 	0.20302066236248986
#*# model_domain = 3.2062740360788736e-07,3.360310635557785e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 54.945177
#*# model_offset = 0.00000
#*#
#*# [scanner]
#*# scanner_touch_threshold = 1750
