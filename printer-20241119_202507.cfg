[include mainsail.cfg]
[include dragonburner_leds.cfg]
[include macros.cfg]
#[include purge_bucket_scrubber.cfg]

[mcu]
canbus_uuid: dc57f6294346

[mcu can0]
canbus_uuid=4d980282845f

[exclude_object]

[skew_correction]

[idle_timeout]
timeout: 36000

[printer]
kinematics: corexy
max_velocity: 3000  
max_accel: 7900    			#Max 4000
max_z_velocity: 15 			#Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350
square_corner_velocity: 4.0

[temperature_sensor MCU]
sensor_type: temperature_mcu

[temperature_sensor SoC]
sensor_type: temperature_host

[temperature_sensor CANBOARD]
sensor_type: temperature_mcu
sensor_mcu: can0

[temperature_sensor chamber]
sensor_type: Generic 3950
Sensor_pin: PA4

########################
# X/Y Stepper Settings #
########################

[stepper_x]
step_pin: PE2
dir_pin: PB4
enable_pin: !PC11
microsteps: 32
rotation_distance: 40
endstop_pin: ^can0:PB8
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: PC10
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_y]
step_pin: PF12
dir_pin: PF11
enable_pin: !PB3
microsteps: 32
rotation_distance: 40
endstop_pin: ^PF3
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 80
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: PF13
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0

######################
# Z Stepper Settings #
######################

[stepper_z]
step_pin: PD8
dir_pin: !PC6
enable_pin: !PC7
rotation_distance: 4
microsteps: 32
#endstop_pin: ^PF5
#position_endstop: -0.5
endstop_pin: probe:z_virtual_endstop
position_max: 340
position_min: -5
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 0

[tmc2209 stepper_z]
uart_pin: PD10
interpolate: true
run_current: 0.8
#hold_current: 0.8
sense_resistor: 0.110
#stealthchop_threshold: 0

[stepper_z1]
step_pin: PD3
dir_pin: !PD2
enable_pin: !PD5
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: PD4
interpolate: true
run_current: 0.8
#hold_current: 0.8
sense_resistor: 0.110
#stealthchop_threshold: 0

[stepper_z2]
step_pin: PC9
dir_pin: !PC8
enable_pin: !PD1
rotation_distance: 4
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: PD0
interpolate: true
run_current: 0.8
#hold_current: 0.80
sense_resistor: 0.110
#stealthchop_threshold: 0


############
# Extruder #
############

[extruder]
step_pin: can0:PD0
dir_pin: can0:PD1
enable_pin: !can0:PD2
rotation_distance: 4.6824
#gear_ratio: 50:10 
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 100.00
max_extrude_only_velocity: 75.0
max_extrude_only_accel: 1500
max_extrude_cross_section: 50
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: can0:PB13
sensor_pin: can0:PA3
sensor_type: ATC Semitec 104NT-4-R025H42G
control: pid
pid_Kp: 21.507
pid_Ki: 1.887
pid_Kd: 61.296
min_temp: 10
max_temp: 290
min_extrude_temp: 180
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: can0:PA15
stealthchop_threshold: 0
run_current: 0.85

[gcode_arcs]
resolution: 0.1

##############
# Bed Heater #
##############

[heater_bed]
heater_pin: PE3
sensor_type: ATC Semitec 104GT-2
sensor_pin: PA0
max_power: 1.0
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.0166
control: pid
pid_kp: 58.437
pid_ki: 2.347
pid_kd: 363.769

[verify_heater heater_bed]
max_error: 50
check_gain_time: 99999
hysteresis: 5
heating_gain: 2

###############
# Fan Control #
###############

[heater_fan hotend_fan]
pin: can0:PA0
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

## PART COOLING
[fan]
pin: can0:PA1
kick_start_time: 0.5
#cycle_time: 0.15
off_below: 0.10

[heater_fan controller_fan_1]
pin: PE6
kick_start_time: 0.5
heater: heater_bed
heater_temp: 20.0

[heater_fan controller_fan_2]
pin: PE0
kick_start_time: 0.5
heater: heater_bed
heater_temp: 20.0

[heater_fan nevermore_fan]
pin: PE4 
kick_start_time: 0.5
heater: heater_bed
heater_temp: 50
fan_speed: 1.0

#################
#  LED Control  #
#################

[output_pin Under Caselight]
pin: PC12
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

[output_pin Above Caselight]
pin: PE5
#max_power: 1.0
#kick_start_time: 0.5
pwm: true
shutdown_value: 0
value: 1
cycle_time: 0.01
#scale: 100

#####################################################
#  Homing, Gantry and Bed Mesh Adjustment Routines  #
#####################################################

[safe_z_home]
home_xy_position:175,175
speed:350
z_hop:20


[z_tilt]
z_positions:
   -50, 18
   175, 398
   400, 18
points:
   50, 5
   175, 300
   300, 5

speed: 400
horizontal_move_z: 10
retries: 20
retry_tolerance: 0.0050

[bed_mesh]
speed: 500
horizontal_move_z: 10
mesh_min: 30,30
mesh_max: 310,310
fade_start: 0.6
fade_end: 10.0
probe_count: 20,20
mesh_pps:2,2
algorithm: bicubic
zero_reference_position: 175, 175

[scanner]
canbus_uuid: f1c7a35486a3            
x_offset: 0                          #    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 27.0                       #    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.00504               #   Backlash compensation distance for removing Z backlash before measuring the sensor response. 
calibration_method: touch            #    leave this as touch unless you want to use scan only for everything. 
sensor: cartographer                 #    this must be set as cartographer unless using IDM etc.
sensor_alt: carto                    #    alternate name to call commands. CARTO_TOUCH etc
#scanner_touch_z_offset: 0.05        #    This is the default and will be overwritten and added to the DO NOT SAVE area by using UI to save z offset
mesh_runs: 2                         #    Number of passes to make during mesh scan.

###################
#  Input Shaping  #
###################

##EBB36
[adxl345]
cs_pin: can0:PB12
spi_software_sclk_pin: can0:PB10
spi_software_mosi_pin: can0:PB11
spi_software_miso_pin: can0:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
    175,175,20  # an example for a 350mm printer
    
[input_shaper]
shaper_freq_x: 79.4 # center frequency for the X axis filter
shaper_type_x: ei # filter type for the X axis
damping_ratio_x: 0.053 # damping ratio for the X axis
shaper_freq_y: 69.6 # center frequency for the Y axis filter
shaper_type_y: 2hump_ei # filter type for the Y axis
damping_ratio_y: 0.053 # damping ratio for the Y axis

[autotune_tmc stepper_x]
motor: moons-ms17hd6p420I-05
tuning_goal: auto
pwm_freq_target: 22e3

[autotune_tmc stepper_y]
motor: moons-ms17hd6p420I-05
tuning_goal: auto
pwm_freq_target: 22e3

[autotune_tmc extruder]
motor: ldo-36sth20-1004ahg
tuning_goal: auto

[autotune_tmc stepper_z]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

[autotune_tmc stepper_z1]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

[autotune_tmc stepper_z2]
motor: moons-le174s-t0804-300-ar3-s-150
tuning_goal: auto

##Cartographer
#[lis2dw]
#cs_pin: cartographer:PA3
#spi_bus: spi1
#
#[resonance_tester]
#accel_chip: lis2dw
#probe_points:
#    175, 175, 20

[gcode_arcs]
resolution: 0.3

    
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.122539, 0.112371, 0.091812, 0.091224, 0.082796, 0.077653, 0.076179, 0.071073, 0.067736, 0.066464, 0.066456, 0.069495, 0.085090, 0.088158, 0.087662, 0.085852, 0.084015, 0.092316, 0.099310, 0.111765
#*# 	  0.099842, 0.081838, 0.067469, 0.065914, 0.063069, 0.057435, 0.054891, 0.057629, 0.054081, 0.051732, 0.055037, 0.057387, 0.076168, 0.078518, 0.076434, 0.080547, 0.077681, 0.081864, 0.090615, 0.103263
#*# 	  0.059282, 0.053193, 0.042311, 0.042326, 0.044098, 0.039842, 0.034198, 0.039751, 0.040636, 0.042131, 0.045200, 0.050160, 0.062681, 0.064059, 0.073628, 0.071646, 0.070369, 0.077965, 0.084074, 0.097359
#*# 	  0.039080, 0.034546, 0.022026, 0.020944, 0.025866, 0.022182, 0.022052, 0.029839, 0.029435, 0.036716, 0.037271, 0.043530, 0.056653, 0.054112, 0.066587, 0.068025, 0.067711, 0.075129, 0.081421, 0.095151
#*# 	  0.007190, 0.011428, -0.001416, -0.003400, -0.000140, -0.001106, 0.005900, 0.016434, 0.021920, 0.022692, 0.024960, 0.027933, 0.042783, 0.046469, 0.059783, 0.059561, 0.061675, 0.069501, 0.074505, 0.086233
#*# 	  -0.005889, -0.013756, -0.022884, -0.024927, -0.021164, -0.019154, -0.006804, -0.000052, 0.006381, 0.011826, 0.012508, 0.016284, 0.029877, 0.044982, 0.051640, 0.058732, 0.055408, 0.063065, 0.067356, 0.083634
#*# 	  -0.011450, -0.019774, -0.032971, -0.035280, -0.031263, -0.022307, -0.011361, -0.003127, 0.000439, 0.007130, 0.007186, 0.015983, 0.032180, 0.042172, 0.047139, 0.054171, 0.055847, 0.065586, 0.077826, 0.093494
#*# 	  -0.038169, -0.038675, -0.050820, -0.050780, -0.045709, -0.034143, -0.026434, -0.013919, -0.003922, 0.002282, -0.000439, 0.007881, 0.028977, 0.029304, 0.044692, 0.049219, 0.049160, 0.059194, 0.072530, 0.091982
#*# 	  -0.059672, -0.063040, -0.061079, -0.057593, -0.047348, -0.037825, -0.034201, -0.022332, -0.009763, 0.010089, 0.001045, 0.006975, 0.022834, 0.030958, 0.043581, 0.048929, 0.048669, 0.061544, 0.070909, 0.088387
#*# 	  -0.062465, -0.068246, -0.072736, -0.065896, -0.054771, -0.041142, -0.028025, -0.019029, -0.007920, 0.001107, 0.004172, 0.013723, 0.028637, 0.031146, 0.042338, 0.052400, 0.060010, 0.085037, 0.087098, 0.105231
#*# 	  -0.078626, -0.078001, -0.081276, -0.074428, -0.062964, -0.051212, -0.038284, -0.021327, -0.014474, -0.002738, 0.003203, 0.011026, 0.023565, 0.034369, 0.052345, 0.058354, 0.060048, 0.077894, 0.087884, 0.106052
#*# 	  -0.088828, -0.091309, -0.091200, -0.082396, -0.069230, -0.058352, -0.044400, -0.034535, -0.020874, -0.006815, 0.003344, 0.012632, 0.025339, 0.031776, 0.051198, 0.065071, 0.062897, 0.082976, 0.090209, 0.111201
#*# 	  -0.097888, -0.091448, -0.101792, -0.091108, -0.078745, -0.067009, -0.049686, -0.037409, -0.027705, -0.012812, -0.001992, 0.010178, 0.028434, 0.039012, 0.059361, 0.063706, 0.069662, 0.086476, 0.097907, 0.116687
#*# 	  -0.088399, -0.093730, -0.096403, -0.089158, -0.073022, -0.062559, -0.040560, -0.030581, -0.022020, -0.009279, 0.001739, 0.022290, 0.044885, 0.057609, 0.067436, 0.076937, 0.076940, 0.091292, 0.111533, 0.136883
#*# 	  -0.094927, -0.091025, -0.091571, -0.082950, -0.067140, -0.053988, -0.048032, -0.035113, -0.019670, -0.004976, 0.008361, 0.033414, 0.055089, 0.053772, 0.072158, 0.087561, 0.088844, 0.102735, 0.126441, 0.145013
#*# 	  -0.094375, -0.091798, -0.090183, -0.081147, -0.071917, -0.057234, -0.038717, -0.026816, -0.015662, -0.002005, 0.013295, 0.041001, 0.060632, 0.064658, 0.081941, 0.094308, 0.090493, 0.113165, 0.139337, 0.168646
#*# 	  -0.104545, -0.102509, -0.096857, -0.082201, -0.070195, -0.055304, -0.040997, -0.026577, -0.013485, 0.002525, 0.021910, 0.042749, 0.067685, 0.080284, 0.089336, 0.100309, 0.101624, 0.123797, 0.145693, 0.169839
#*# 	  -0.100172, -0.094282, -0.091725, -0.077632, -0.062887, -0.049761, -0.036963, -0.020100, -0.003533, 0.011639, 0.030130, 0.053064, 0.078326, 0.090648, 0.103541, 0.115619, 0.122597, 0.142232, 0.161247, 0.188066
#*# 	  -0.090086, -0.082868, -0.080987, -0.062934, -0.047405, -0.035814, -0.015564, 0.002907, 0.016417, 0.030112, 0.046772, 0.070004, 0.095333, 0.114489, 0.133942, 0.140686, 0.146890, 0.168217, 0.186866, 0.210318
#*# 	  -0.088784, -0.073168, -0.063322, -0.051403, -0.032670, -0.020202, -0.003416, 0.015058, 0.038304, 0.056161, 0.068788, 0.085896, 0.112775, 0.126219, 0.156311, 0.169652, 0.174322, 0.193188, 0.206790, 0.236144
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 310.0
#*# min_y = 30.0
#*# max_y = 310.0
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = -0.0006646821849444252
#*# xz_skew = -9.899520833820424e-05
#*# yz_skew = -0.003408273324093036